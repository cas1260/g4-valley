#!/bin/bash

# ============================================================================
# Script de Build Completo - Landing Page G4 Valley
# ============================================================================
# Este script gera o build completo e atualiza a pasta novidades/
# Autor: Equipe SwapSoft
# Data: 16/11/2025
# ============================================================================

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ              ๐ BUILD COMPLETO - LANDING PAGE G4 VALLEY ๐                   โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# Cores para output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# Diretรณrio do projeto
PROJECT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd "$PROJECT_DIR"

echo -e "${BLUE}๐ Diretรณrio do projeto: ${NC}$PROJECT_DIR"
echo ""

# ============================================================================
# PASSO 1: Gerar Build do Frontend
# ============================================================================
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${BLUE}๐ PASSO 1: Gerando build do frontend...${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

npm run build

if [ $? -ne 0 ]; then
    echo -e "${RED}โ Erro ao gerar build do frontend!${NC}"
    exit 1
fi

echo ""
echo -e "${GREEN}โ Build do frontend gerado com sucesso!${NC}"
echo ""

# ============================================================================
# PASSO 2: Limpar pasta novidades
# ============================================================================
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${BLUE}๐๏ธ  PASSO 2: Limpando pasta novidades...${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

# Remover apenas frontend antigo (manter server/)
rm -rf novidades/assets 2>/dev/null
rm -f novidades/index.html 2>/dev/null
rm -f novidades/.htaccess 2>/dev/null

echo -e "${GREEN}โ Pasta novidades limpa!${NC}"
echo ""

# ============================================================================
# PASSO 3: Copiar Frontend
# ============================================================================
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${BLUE}๐ PASSO 3: Copiando frontend...${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

# Criar pasta novidades se nรฃo existir
mkdir -p novidades

# Copiar arquivos do dist
cp -r dist/* novidades/

echo -e "${GREEN}โ Frontend copiado!${NC}"
echo ""

# ============================================================================
# PASSO 4: Copiar .htaccess
# ============================================================================
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${BLUE}๐ PASSO 4: Copiando .htaccess...${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

cp public/.htaccess novidades/.htaccess

echo -e "${GREEN}โ .htaccess copiado!${NC}"
echo ""

# ============================================================================
# PASSO 5: Atualizar Backend
# ============================================================================
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${BLUE}โ๏ธ  PASSO 5: Atualizando backend...${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

# Criar pasta server se nรฃo existir
mkdir -p novidades/server

# Copiar todos os arquivos do servidor
cp -rf server/* novidades/server/

echo -e "${GREEN}โ Backend atualizado!${NC}"
echo ""

# ============================================================================
# PASSO 6: Verificaรงรฃo Final
# ============================================================================
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${BLUE}๐ PASSO 6: Verificaรงรฃo final...${NC}"
echo -e "${YELLOW}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

# Verificar tamanho
FOLDER_SIZE=$(du -sh novidades | cut -f1)
echo -e "${BLUE}๐ Tamanho total:${NC} $FOLDER_SIZE"
echo ""

# Verificar estrutura
echo -e "${BLUE}๐ Estrutura:${NC}"
ls -lh novidades/ | grep -v total
echo ""

# Verificar assets
echo -e "${BLUE}๐จ Assets:${NC}"
ls -lh novidades/assets/ | grep -E "\.(js|css)" | head -5
echo ""

# Verificar backend
echo -e "${BLUE}โ๏ธ  Backend (principais):${NC}"
ls -1 novidades/server/*.php | grep -E "(contact|database|smtp-config|visitor|stats)" | head -10
echo ""

# ============================================================================
# RESUMO FINAL
# ============================================================================
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ                   โ BUILD COMPLETO FINALIZADO โ                            โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo -e "${GREEN}โ FRONTEND:${NC}"
echo "   โข index.html"
echo "   โข .htaccess"
echo "   โข assets/ (JS, CSS, imagens)"
echo ""
echo -e "${GREEN}โ BACKEND:${NC}"
echo "   โข PHPMailer"
echo "   โข contact.php (formulรกrio + e-mail)"
echo "   โข database.php (SQLite + migraรงรฃo)"
echo "   โข smtp-config.php (SwapSoft)"
echo "   โข Analytics completo"
echo ""
echo -e "${GREEN}โ CONFIGURAรรES:${NC}"
echo "   โข Analytics: REATIVADO"
echo "   โข Formulรกrio: CORRIGIDO"
echo "   โข SMTP: Configurado (mail.swapsoft.com.br:465)"
echo "   โข Banco: Migraรงรฃo automรกtica (click_x, click_y)"
echo ""
echo -e "${BLUE}๐ฆ Pasta:${NC} novidades/ ($FOLDER_SIZE)"
echo -e "${BLUE}๐ URL:${NC} https://swapsoft.com.br/novidades/"
echo -e "${BLUE}๐ Dashboard:${NC} https://swapsoft.com.br/novidades/statics"
echo ""
echo -e "${GREEN}๐ PRONTO PARA UPLOAD E DEPLOY!${NC}"
echo ""



